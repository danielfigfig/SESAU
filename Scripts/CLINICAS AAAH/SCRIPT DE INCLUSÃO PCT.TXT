/**
 * @OnlyCurrentDoc
 * O c√≥digo abaixo cria um menu personalizado na planilha para gerenciar pacientes.
 */

// Esta fun√ß√£o √© executada automaticamente quando a planilha √© aberta.
function onOpen() {
  SpreadsheetApp.getUi()
      .createMenu('üè• Controle de Pacientes')
      .addItem('‚ûï Adicionar Novo Paciente', 'abrirFormulario')
      .addToUi();
}

/**
 * Abre o formul√°rio de cadastro de pacientes em um di√°logo modal.
 */
function abrirFormulario() {
  // Cria o HTML a partir do arquivo 'Formulario.html'
  var html = HtmlService.createHtmlOutputFromFile('Formulario')
      .setWidth(600)
      .setHeight(550);
  // Exibe o formul√°rio
  SpreadsheetApp.getUi().showModalDialog(html, 'Registrar Novo Paciente');
}

/**
 * Salva os dados do formul√°rio na planilha.
 * @param {Object} dadosDoFormulario O objeto contendo os dados do paciente.
 */
function salvarDados(dadosDoFormulario) {
  try {
    // IMPORTANTE: Altere 'Dados' para o nome exato da aba onde os dados devem ser salvos.
    var aba = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Dados');
    
    // Se a aba n√£o for encontrada, lan√ßa um erro.
    if (!aba) {
      throw new Error("A aba 'Dados' n√£o foi encontrada. Verifique o nome da sua planilha.");
    }
    
    // Monta a linha na ordem correta das colunas da sua planilha
    // Ajuste a ordem se as colunas da sua planilha forem diferentes.
    aba.appendRow([
      dadosDoFormulario.data,
      dadosDoFormulario.paciente,
      dadosDoFormulario.idade,
      dadosDoFormulario.dependencia,
      dadosDoFormulario.motivo,
      dadosDoFormulario.enfermeiro,
      dadosDoFormulario.evolucao,
      dadosDoFormulario.pendencia,
      dadosDoFormulario.ambiente,
      dadosDoFormulario.alta === 'Sim' ? 'SIM' : 'N√ÉO', // Converte para mai√∫sculo
      dadosDoFormulario.leito
    ]);
    
    // Retorna uma mensagem de sucesso
    return { status: 'sucesso', mensagem: 'Paciente adicionado com sucesso!' };
  } catch (e) {
    // Retorna uma mensagem de erro
    Logger.log(e);
    return { status: 'erro', mensagem: e.toString() };
  }
}